{"version":3,"sources":["index.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["\r\n\r\nvar GetIntrinsic = require('get-intrinsic');\r\nvar callBound = require('call-bound');\r\nvar inspect = require('object-inspect');\r\nvar getSideChannelMap = require('side-channel-map');\r\n\r\nvar $TypeError = require('es-errors/type');\r\nvar $WeakMap = GetIntrinsic('%WeakMap%', true);\r\n\r\n/** @type {<K extends object, V>(thisArg: WeakMap<K, V>, key: K) => V} */\r\nvar $weakMapGet = callBound('WeakMap.prototype.get', true);\r\n/** @type {<K extends object, V>(thisArg: WeakMap<K, V>, key: K, value: V) => void} */\r\nvar $weakMapSet = callBound('WeakMap.prototype.set', true);\r\n/** @type {<K extends object, V>(thisArg: WeakMap<K, V>, key: K) => boolean} */\r\nvar $weakMapHas = callBound('WeakMap.prototype.has', true);\r\n/** @type {<K extends object, V>(thisArg: WeakMap<K, V>, key: K) => boolean} */\r\nvar $weakMapDelete = callBound('WeakMap.prototype.delete', true);\r\n\r\n/** @type {import('.')} */\r\nmodule.exports = $WeakMap\r\n\t? /** @type {Exclude<import('.'), false>} */ function getSideChannelWeakMap() {\r\n\t\t/** @typedef {ReturnType<typeof getSideChannelWeakMap>} Channel */\r\n\t\t/** @typedef {Parameters<Channel['get']>[0]} K */\r\n\t\t/** @typedef {Parameters<Channel['set']>[1]} V */\r\n\r\n\t\t/** @type {WeakMap<K & object, V> | undefined} */ var $wm;\r\n\t\t/** @type {Channel | undefined} */ var $m;\r\n\r\n\t\t/** @type {Channel} */\r\n\t\tvar channel = {\r\n\t\t\tassert: function (key) {\r\n\t\t\t\tif (!channel.has(key)) {\r\n\t\t\t\t\tthrow new $TypeError('Side channel does not contain ' + inspect(key));\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'delete': function (key) {\r\n\t\t\t\tif ($WeakMap && key && (typeof key === 'object' || typeof key === 'function')) {\r\n\t\t\t\t\tif ($wm) {\r\n\t\t\t\t\t\treturn $weakMapDelete($wm, key);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (getSideChannelMap) {\r\n\t\t\t\t\tif ($m) {\r\n\t\t\t\t\t\treturn $m['delete'](key);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t},\r\n\t\t\tget: function (key) {\r\n\t\t\t\tif ($WeakMap && key && (typeof key === 'object' || typeof key === 'function')) {\r\n\t\t\t\t\tif ($wm) {\r\n\t\t\t\t\t\treturn $weakMapGet($wm, key);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn $m && $m.get(key);\r\n\t\t\t},\r\n\t\t\thas: function (key) {\r\n\t\t\t\tif ($WeakMap && key && (typeof key === 'object' || typeof key === 'function')) {\r\n\t\t\t\t\tif ($wm) {\r\n\t\t\t\t\t\treturn $weakMapHas($wm, key);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn !!$m && $m.has(key);\r\n\t\t\t},\r\n\t\t\tset: function (key, value) {\r\n\t\t\t\tif ($WeakMap && key && (typeof key === 'object' || typeof key === 'function')) {\r\n\t\t\t\t\tif (!$wm) {\r\n\t\t\t\t\t\t$wm = new $WeakMap();\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$weakMapSet($wm, key, value);\r\n\t\t\t\t} else if (getSideChannelMap) {\r\n\t\t\t\t\tif (!$m) {\r\n\t\t\t\t\t\t$m = getSideChannelMap();\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// eslint-disable-next-line no-extra-parens\r\n\t\t\t\t\t/** @type {NonNullable<typeof $m>} */ ($m).set(key, value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// @ts-expect-error TODO: figure out why this is erroring\r\n\t\treturn channel;\r\n\t}\r\n\t: getSideChannelMap;\r\n"]}