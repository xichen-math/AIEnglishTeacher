{"version":3,"sources":["xml2js.js","defaults.js","builder.js","parser.js","bom.js","processors.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,AENA,AHSA;AELA,ADGA,AENA,AHSA;AELA,ADGA,AENA,AHSA;AIXA,AFMA,ADGA,AENA,AHSA;AIXA,AFMA,ADGA,AENA,AHSA;AIXA,AFMA,ADGA,AENA,AHSA;AIXA,AFMA,ADGA,AENA,AENA,ALeA;AIXA,AFMA,ADGA,AENA,AENA,ALeA;AIXA,AFMA,ADGA,AENA,AENA,ALeA;AIXA,AFMA,ADGA,AENA,AENA,ALeA;AIXA,AFMA,ADGA,AENA,AENA,ALeA;AIXA,AFMA,ADGA,AENA,AENA,ALeA;AIXA,AFMA,ADGA,AENA,AENA,ALeA;AIXA,AFMA,ADGA,AENA,AENA,ALeA;AIXA,AFMA,ADGA,AENA,AENA,ALeA;AIXA,AFMA,ADGA,AENA,AENA,ALeA;AELA,ADGA,AENA,AENA,ALeA;AELA,ADGA,AENA,AENA,ALeA;AELA,ADGA,AENA,AENA,ALeA;AELA,ADGA,AENA,AENA,ALeA;AELA,ADGA,AENA,AENA,ALeA;AELA,ADGA,AENA,AENA,ALeA;AELA,ADGA,AENA,AENA,ALeA;AELA,ADGA,AENA,AENA,ALeA;AELA,ADGA,AENA,AENA,ALeA;AELA,ADGA,AENA,AENA,ALeA;AELA,ADGA,AENA,AENA,ALeA;AELA,ADGA,AENA,AENA,ALeA;AELA,ADGA,AENA,AENA,ALeA;AELA,ADGA,AENA,AENA,ALeA;AELA,ADGA,AENA,AENA,ALeA;AELA,ADGA,AENA,AENA;AHUA,ADGA,AENA,AENA;AHUA,ADGA,AENA,AENA;AHUA,ADGA,AENA,AENA;AHUA,ADGA,AENA,AENA;AHUA,ADGA,AENA,AENA;AHUA,ADGA,AENA,AENA;AHUA,ADGA,AENA,AENA;AHUA,ADGA,AENA,AENA;AHUA,ADGA,AENA,AENA;AHUA,ADGA,AENA;ADIA,ADGA,AENA;ADIA,ADGA,AENA;ADIA,ADGA,AENA;ADIA,ADGA,AENA;ADIA,ADGA,AENA;ADIA,ADGA,AENA;ADIA,ADGA,AENA;ADIA,ADGA,AENA;ADIA,ADGA,AENA;ADIA,ADGA,AENA;ADIA,ADGA,AENA;ADIA,ADGA,AENA;ADIA,ADGA,AENA;ADIA,ADGA,AENA;ADIA,ADGA,AENA;ADIA,ADGA,AENA;ADIA,ADGA,AENA;ADIA,ADGA,AENA;ADIA,ADGA,AENA;ADIA,ADGA,AENA;ADIA,ADGA,AENA;ADIA,ADGA,AENA;ADIA,ADGA,AENA;ADIA,ADGA,AENA;ADIA,ADGA,AENA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["// Generated by CoffeeScript 1.12.7\r\n(function() {\r\n  \r\n  var builder, defaults, parser, processors,\r\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\r\n    hasProp = {}.hasOwnProperty;\r\n\r\n  defaults = require('./defaults');\r\n\r\n  builder = require('./builder');\r\n\r\n  parser = require('./parser');\r\n\r\n  processors = require('./processors');\r\n\r\n  exports.defaults = defaults.defaults;\r\n\r\n  exports.processors = processors;\r\n\r\n  exports.ValidationError = (function(superClass) {\r\n    extend(ValidationError, superClass);\r\n\r\n    function ValidationError(message) {\r\n      this.message = message;\r\n    }\r\n\r\n    return ValidationError;\r\n\r\n  })(Error);\r\n\r\n  exports.Builder = builder.Builder;\r\n\r\n  exports.Parser = parser.Parser;\r\n\r\n  exports.parseString = parser.parseString;\r\n\r\n  exports.parseStringPromise = parser.parseStringPromise;\r\n\r\n}).call(this);\r\n","// Generated by CoffeeScript 1.12.7\r\n(function() {\r\n  exports.defaults = {\r\n    \"0.1\": {\r\n      explicitCharkey: false,\r\n      trim: true,\r\n      normalize: true,\r\n      normalizeTags: false,\r\n      attrkey: \"@\",\r\n      charkey: \"#\",\r\n      explicitArray: false,\r\n      ignoreAttrs: false,\r\n      mergeAttrs: false,\r\n      explicitRoot: false,\r\n      validator: null,\r\n      xmlns: false,\r\n      explicitChildren: false,\r\n      childkey: '@@',\r\n      charsAsChildren: false,\r\n      includeWhiteChars: false,\r\n      async: false,\r\n      strict: true,\r\n      attrNameProcessors: null,\r\n      attrValueProcessors: null,\r\n      tagNameProcessors: null,\r\n      valueProcessors: null,\r\n      emptyTag: ''\r\n    },\r\n    \"0.2\": {\r\n      explicitCharkey: false,\r\n      trim: false,\r\n      normalize: false,\r\n      normalizeTags: false,\r\n      attrkey: \"$\",\r\n      charkey: \"_\",\r\n      explicitArray: true,\r\n      ignoreAttrs: false,\r\n      mergeAttrs: false,\r\n      explicitRoot: true,\r\n      validator: null,\r\n      xmlns: false,\r\n      explicitChildren: false,\r\n      preserveChildrenOrder: false,\r\n      childkey: '$$',\r\n      charsAsChildren: false,\r\n      includeWhiteChars: false,\r\n      async: false,\r\n      strict: true,\r\n      attrNameProcessors: null,\r\n      attrValueProcessors: null,\r\n      tagNameProcessors: null,\r\n      valueProcessors: null,\r\n      rootName: 'root',\r\n      xmldec: {\r\n        'version': '1.0',\r\n        'encoding': 'UTF-8',\r\n        'standalone': true\r\n      },\r\n      doctype: null,\r\n      renderOpts: {\r\n        'pretty': true,\r\n        'indent': '  ',\r\n        'newline': '\\n'\r\n      },\r\n      headless: false,\r\n      chunkSize: 10000,\r\n      emptyTag: '',\r\n      cdata: false\r\n    }\r\n  };\r\n\r\n}).call(this);\r\n","// Generated by CoffeeScript 1.12.7\r\n(function() {\r\n  \r\n  var builder, defaults, escapeCDATA, requiresCDATA, wrapCDATA,\r\n    hasProp = {}.hasOwnProperty;\r\n\r\n  builder = require('xmlbuilder');\r\n\r\n  defaults = require('./defaults').defaults;\r\n\r\n  requiresCDATA = function(entry) {\r\n    return typeof entry === \"string\" && (entry.indexOf('&') >= 0 || entry.indexOf('>') >= 0 || entry.indexOf('<') >= 0);\r\n  };\r\n\r\n  wrapCDATA = function(entry) {\r\n    return \"<![CDATA[\" + (escapeCDATA(entry)) + \"]]>\";\r\n  };\r\n\r\n  escapeCDATA = function(entry) {\r\n    return entry.replace(']]>', ']]]]><![CDATA[>');\r\n  };\r\n\r\n  exports.Builder = (function() {\r\n    function Builder(opts) {\r\n      var key, ref, value;\r\n      this.options = {};\r\n      ref = defaults[\"0.2\"];\r\n      for (key in ref) {\r\n        if (!hasProp.call(ref, key)) continue;\r\n        value = ref[key];\r\n        this.options[key] = value;\r\n      }\r\n      for (key in opts) {\r\n        if (!hasProp.call(opts, key)) continue;\r\n        value = opts[key];\r\n        this.options[key] = value;\r\n      }\r\n    }\r\n\r\n    Builder.prototype.buildObject = function(rootObj) {\r\n      var attrkey, charkey, render, rootElement, rootName;\r\n      attrkey = this.options.attrkey;\r\n      charkey = this.options.charkey;\r\n      if ((Object.keys(rootObj).length === 1) && (this.options.rootName === defaults['0.2'].rootName)) {\r\n        rootName = Object.keys(rootObj)[0];\r\n        rootObj = rootObj[rootName];\r\n      } else {\r\n        rootName = this.options.rootName;\r\n      }\r\n      render = (function(_this) {\r\n        return function(element, obj) {\r\n          var attr, child, entry, index, key, value;\r\n          if (typeof obj !== 'object') {\r\n            if (_this.options.cdata && requiresCDATA(obj)) {\r\n              element.raw(wrapCDATA(obj));\r\n            } else {\r\n              element.txt(obj);\r\n            }\r\n          } else if (Array.isArray(obj)) {\r\n            for (index in obj) {\r\n              if (!hasProp.call(obj, index)) continue;\r\n              child = obj[index];\r\n              for (key in child) {\r\n                entry = child[key];\r\n                element = render(element.ele(key), entry).up();\r\n              }\r\n            }\r\n          } else {\r\n            for (key in obj) {\r\n              if (!hasProp.call(obj, key)) continue;\r\n              child = obj[key];\r\n              if (key === attrkey) {\r\n                if (typeof child === \"object\") {\r\n                  for (attr in child) {\r\n                    value = child[attr];\r\n                    element = element.att(attr, value);\r\n                  }\r\n                }\r\n              } else if (key === charkey) {\r\n                if (_this.options.cdata && requiresCDATA(child)) {\r\n                  element = element.raw(wrapCDATA(child));\r\n                } else {\r\n                  element = element.txt(child);\r\n                }\r\n              } else if (Array.isArray(child)) {\r\n                for (index in child) {\r\n                  if (!hasProp.call(child, index)) continue;\r\n                  entry = child[index];\r\n                  if (typeof entry === 'string') {\r\n                    if (_this.options.cdata && requiresCDATA(entry)) {\r\n                      element = element.ele(key).raw(wrapCDATA(entry)).up();\r\n                    } else {\r\n                      element = element.ele(key, entry).up();\r\n                    }\r\n                  } else {\r\n                    element = render(element.ele(key), entry).up();\r\n                  }\r\n                }\r\n              } else if (typeof child === \"object\") {\r\n                element = render(element.ele(key), child).up();\r\n              } else {\r\n                if (typeof child === 'string' && _this.options.cdata && requiresCDATA(child)) {\r\n                  element = element.ele(key).raw(wrapCDATA(child)).up();\r\n                } else {\r\n                  if (child == null) {\r\n                    child = '';\r\n                  }\r\n                  element = element.ele(key, child.toString()).up();\r\n                }\r\n              }\r\n            }\r\n          }\r\n          return element;\r\n        };\r\n      })(this);\r\n      rootElement = builder.create(rootName, this.options.xmldec, this.options.doctype, {\r\n        headless: this.options.headless,\r\n        allowSurrogateChars: this.options.allowSurrogateChars\r\n      });\r\n      return render(rootElement, rootObj).end(this.options.renderOpts);\r\n    };\r\n\r\n    return Builder;\r\n\r\n  })();\r\n\r\n}).call(this);\r\n","// Generated by CoffeeScript 1.12.7\r\n(function() {\r\n  \r\n  var bom, defaults, events, isEmpty, processItem, processors, sax, setImmediate,\r\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\r\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\r\n    hasProp = {}.hasOwnProperty;\r\n\r\n  sax = require('sax');\r\n\r\n  events = require('events');\r\n\r\n  bom = require('./bom');\r\n\r\n  processors = require('./processors');\r\n\r\n  setImmediate = require('timers').setImmediate;\r\n\r\n  defaults = require('./defaults').defaults;\r\n\r\n  isEmpty = function(thing) {\r\n    return typeof thing === \"object\" && (thing != null) && Object.keys(thing).length === 0;\r\n  };\r\n\r\n  processItem = function(processors, item, key) {\r\n    var i, len, process;\r\n    for (i = 0, len = processors.length; i < len; i++) {\r\n      process = processors[i];\r\n      item = process(item, key);\r\n    }\r\n    return item;\r\n  };\r\n\r\n  exports.Parser = (function(superClass) {\r\n    extend(Parser, superClass);\r\n\r\n    function Parser(opts) {\r\n      this.parseStringPromise = bind(this.parseStringPromise, this);\r\n      this.parseString = bind(this.parseString, this);\r\n      this.reset = bind(this.reset, this);\r\n      this.assignOrPush = bind(this.assignOrPush, this);\r\n      this.processAsync = bind(this.processAsync, this);\r\n      var key, ref, value;\r\n      if (!(this instanceof exports.Parser)) {\r\n        return new exports.Parser(opts);\r\n      }\r\n      this.options = {};\r\n      ref = defaults[\"0.2\"];\r\n      for (key in ref) {\r\n        if (!hasProp.call(ref, key)) continue;\r\n        value = ref[key];\r\n        this.options[key] = value;\r\n      }\r\n      for (key in opts) {\r\n        if (!hasProp.call(opts, key)) continue;\r\n        value = opts[key];\r\n        this.options[key] = value;\r\n      }\r\n      if (this.options.xmlns) {\r\n        this.options.xmlnskey = this.options.attrkey + \"ns\";\r\n      }\r\n      if (this.options.normalizeTags) {\r\n        if (!this.options.tagNameProcessors) {\r\n          this.options.tagNameProcessors = [];\r\n        }\r\n        this.options.tagNameProcessors.unshift(processors.normalize);\r\n      }\r\n      this.reset();\r\n    }\r\n\r\n    Parser.prototype.processAsync = function() {\r\n      var chunk, err;\r\n      try {\r\n        if (this.remaining.length <= this.options.chunkSize) {\r\n          chunk = this.remaining;\r\n          this.remaining = '';\r\n          this.saxParser = this.saxParser.write(chunk);\r\n          return this.saxParser.close();\r\n        } else {\r\n          chunk = this.remaining.substr(0, this.options.chunkSize);\r\n          this.remaining = this.remaining.substr(this.options.chunkSize, this.remaining.length);\r\n          this.saxParser = this.saxParser.write(chunk);\r\n          return setImmediate(this.processAsync);\r\n        }\r\n      } catch (error1) {\r\n        err = error1;\r\n        if (!this.saxParser.errThrown) {\r\n          this.saxParser.errThrown = true;\r\n          return this.emit(err);\r\n        }\r\n      }\r\n    };\r\n\r\n    Parser.prototype.assignOrPush = function(obj, key, newValue) {\r\n      if (!(key in obj)) {\r\n        if (!this.options.explicitArray) {\r\n          return obj[key] = newValue;\r\n        } else {\r\n          return obj[key] = [newValue];\r\n        }\r\n      } else {\r\n        if (!(obj[key] instanceof Array)) {\r\n          obj[key] = [obj[key]];\r\n        }\r\n        return obj[key].push(newValue);\r\n      }\r\n    };\r\n\r\n    Parser.prototype.reset = function() {\r\n      var attrkey, charkey, ontext, stack;\r\n      this.removeAllListeners();\r\n      this.saxParser = sax.parser(this.options.strict, {\r\n        trim: false,\r\n        normalize: false,\r\n        xmlns: this.options.xmlns\r\n      });\r\n      this.saxParser.errThrown = false;\r\n      this.saxParser.onerror = (function(_this) {\r\n        return function(error) {\r\n          _this.saxParser.resume();\r\n          if (!_this.saxParser.errThrown) {\r\n            _this.saxParser.errThrown = true;\r\n            return _this.emit(\"error\", error);\r\n          }\r\n        };\r\n      })(this);\r\n      this.saxParser.onend = (function(_this) {\r\n        return function() {\r\n          if (!_this.saxParser.ended) {\r\n            _this.saxParser.ended = true;\r\n            return _this.emit(\"end\", _this.resultObject);\r\n          }\r\n        };\r\n      })(this);\r\n      this.saxParser.ended = false;\r\n      this.EXPLICIT_CHARKEY = this.options.explicitCharkey;\r\n      this.resultObject = null;\r\n      stack = [];\r\n      attrkey = this.options.attrkey;\r\n      charkey = this.options.charkey;\r\n      this.saxParser.onopentag = (function(_this) {\r\n        return function(node) {\r\n          var key, newValue, obj, processedKey, ref;\r\n          obj = {};\r\n          obj[charkey] = \"\";\r\n          if (!_this.options.ignoreAttrs) {\r\n            ref = node.attributes;\r\n            for (key in ref) {\r\n              if (!hasProp.call(ref, key)) continue;\r\n              if (!(attrkey in obj) && !_this.options.mergeAttrs) {\r\n                obj[attrkey] = {};\r\n              }\r\n              newValue = _this.options.attrValueProcessors ? processItem(_this.options.attrValueProcessors, node.attributes[key], key) : node.attributes[key];\r\n              processedKey = _this.options.attrNameProcessors ? processItem(_this.options.attrNameProcessors, key) : key;\r\n              if (_this.options.mergeAttrs) {\r\n                _this.assignOrPush(obj, processedKey, newValue);\r\n              } else {\r\n                obj[attrkey][processedKey] = newValue;\r\n              }\r\n            }\r\n          }\r\n          obj[\"#name\"] = _this.options.tagNameProcessors ? processItem(_this.options.tagNameProcessors, node.name) : node.name;\r\n          if (_this.options.xmlns) {\r\n            obj[_this.options.xmlnskey] = {\r\n              uri: node.uri,\r\n              local: node.local\r\n            };\r\n          }\r\n          return stack.push(obj);\r\n        };\r\n      })(this);\r\n      this.saxParser.onclosetag = (function(_this) {\r\n        return function() {\r\n          var cdata, emptyStr, key, node, nodeName, obj, objClone, old, s, xpath;\r\n          obj = stack.pop();\r\n          nodeName = obj[\"#name\"];\r\n          if (!_this.options.explicitChildren || !_this.options.preserveChildrenOrder) {\r\n            delete obj[\"#name\"];\r\n          }\r\n          if (obj.cdata === true) {\r\n            cdata = obj.cdata;\r\n            delete obj.cdata;\r\n          }\r\n          s = stack[stack.length - 1];\r\n          if (obj[charkey].match(/^\\s*$/) && !cdata) {\r\n            emptyStr = obj[charkey];\r\n            delete obj[charkey];\r\n          } else {\r\n            if (_this.options.trim) {\r\n              obj[charkey] = obj[charkey].trim();\r\n            }\r\n            if (_this.options.normalize) {\r\n              obj[charkey] = obj[charkey].replace(/\\s{2,}/g, \" \").trim();\r\n            }\r\n            obj[charkey] = _this.options.valueProcessors ? processItem(_this.options.valueProcessors, obj[charkey], nodeName) : obj[charkey];\r\n            if (Object.keys(obj).length === 1 && charkey in obj && !_this.EXPLICIT_CHARKEY) {\r\n              obj = obj[charkey];\r\n            }\r\n          }\r\n          if (isEmpty(obj)) {\r\n            obj = _this.options.emptyTag !== '' ? _this.options.emptyTag : emptyStr;\r\n          }\r\n          if (_this.options.validator != null) {\r\n            xpath = \"/\" + ((function() {\r\n              var i, len, results;\r\n              results = [];\r\n              for (i = 0, len = stack.length; i < len; i++) {\r\n                node = stack[i];\r\n                results.push(node[\"#name\"]);\r\n              }\r\n              return results;\r\n            })()).concat(nodeName).join(\"/\");\r\n            (function() {\r\n              var err;\r\n              try {\r\n                return obj = _this.options.validator(xpath, s && s[nodeName], obj);\r\n              } catch (error1) {\r\n                err = error1;\r\n                return _this.emit(\"error\", err);\r\n              }\r\n            })();\r\n          }\r\n          if (_this.options.explicitChildren && !_this.options.mergeAttrs && typeof obj === 'object') {\r\n            if (!_this.options.preserveChildrenOrder) {\r\n              node = {};\r\n              if (_this.options.attrkey in obj) {\r\n                node[_this.options.attrkey] = obj[_this.options.attrkey];\r\n                delete obj[_this.options.attrkey];\r\n              }\r\n              if (!_this.options.charsAsChildren && _this.options.charkey in obj) {\r\n                node[_this.options.charkey] = obj[_this.options.charkey];\r\n                delete obj[_this.options.charkey];\r\n              }\r\n              if (Object.getOwnPropertyNames(obj).length > 0) {\r\n                node[_this.options.childkey] = obj;\r\n              }\r\n              obj = node;\r\n            } else if (s) {\r\n              s[_this.options.childkey] = s[_this.options.childkey] || [];\r\n              objClone = {};\r\n              for (key in obj) {\r\n                if (!hasProp.call(obj, key)) continue;\r\n                objClone[key] = obj[key];\r\n              }\r\n              s[_this.options.childkey].push(objClone);\r\n              delete obj[\"#name\"];\r\n              if (Object.keys(obj).length === 1 && charkey in obj && !_this.EXPLICIT_CHARKEY) {\r\n                obj = obj[charkey];\r\n              }\r\n            }\r\n          }\r\n          if (stack.length > 0) {\r\n            return _this.assignOrPush(s, nodeName, obj);\r\n          } else {\r\n            if (_this.options.explicitRoot) {\r\n              old = obj;\r\n              obj = {};\r\n              obj[nodeName] = old;\r\n            }\r\n            _this.resultObject = obj;\r\n            _this.saxParser.ended = true;\r\n            return _this.emit(\"end\", _this.resultObject);\r\n          }\r\n        };\r\n      })(this);\r\n      ontext = (function(_this) {\r\n        return function(text) {\r\n          var charChild, s;\r\n          s = stack[stack.length - 1];\r\n          if (s) {\r\n            s[charkey] += text;\r\n            if (_this.options.explicitChildren && _this.options.preserveChildrenOrder && _this.options.charsAsChildren && (_this.options.includeWhiteChars || text.replace(/\\\\n/g, '').trim() !== '')) {\r\n              s[_this.options.childkey] = s[_this.options.childkey] || [];\r\n              charChild = {\r\n                '#name': '__text__'\r\n              };\r\n              charChild[charkey] = text;\r\n              if (_this.options.normalize) {\r\n                charChild[charkey] = charChild[charkey].replace(/\\s{2,}/g, \" \").trim();\r\n              }\r\n              s[_this.options.childkey].push(charChild);\r\n            }\r\n            return s;\r\n          }\r\n        };\r\n      })(this);\r\n      this.saxParser.ontext = ontext;\r\n      return this.saxParser.oncdata = (function(_this) {\r\n        return function(text) {\r\n          var s;\r\n          s = ontext(text);\r\n          if (s) {\r\n            return s.cdata = true;\r\n          }\r\n        };\r\n      })(this);\r\n    };\r\n\r\n    Parser.prototype.parseString = function(str, cb) {\r\n      var err;\r\n      if ((cb != null) && typeof cb === \"function\") {\r\n        this.on(\"end\", function(result) {\r\n          this.reset();\r\n          return cb(null, result);\r\n        });\r\n        this.on(\"error\", function(err) {\r\n          this.reset();\r\n          return cb(err);\r\n        });\r\n      }\r\n      try {\r\n        str = str.toString();\r\n        if (str.trim() === '') {\r\n          this.emit(\"end\", null);\r\n          return true;\r\n        }\r\n        str = bom.stripBOM(str);\r\n        if (this.options.async) {\r\n          this.remaining = str;\r\n          setImmediate(this.processAsync);\r\n          return this.saxParser;\r\n        }\r\n        return this.saxParser.write(str).close();\r\n      } catch (error1) {\r\n        err = error1;\r\n        if (!(this.saxParser.errThrown || this.saxParser.ended)) {\r\n          this.emit('error', err);\r\n          return this.saxParser.errThrown = true;\r\n        } else if (this.saxParser.ended) {\r\n          throw err;\r\n        }\r\n      }\r\n    };\r\n\r\n    Parser.prototype.parseStringPromise = function(str) {\r\n      return new Promise((function(_this) {\r\n        return function(resolve, reject) {\r\n          return _this.parseString(str, function(err, value) {\r\n            if (err) {\r\n              return reject(err);\r\n            } else {\r\n              return resolve(value);\r\n            }\r\n          });\r\n        };\r\n      })(this));\r\n    };\r\n\r\n    return Parser;\r\n\r\n  })(events);\r\n\r\n  exports.parseString = function(str, a, b) {\r\n    var cb, options, parser;\r\n    if (b != null) {\r\n      if (typeof b === 'function') {\r\n        cb = b;\r\n      }\r\n      if (typeof a === 'object') {\r\n        options = a;\r\n      }\r\n    } else {\r\n      if (typeof a === 'function') {\r\n        cb = a;\r\n      }\r\n      options = {};\r\n    }\r\n    parser = new exports.Parser(options);\r\n    return parser.parseString(str, cb);\r\n  };\r\n\r\n  exports.parseStringPromise = function(str, a) {\r\n    var options, parser;\r\n    if (typeof a === 'object') {\r\n      options = a;\r\n    }\r\n    parser = new exports.Parser(options);\r\n    return parser.parseStringPromise(str);\r\n  };\r\n\r\n}).call(this);\r\n","// Generated by CoffeeScript 1.12.7\r\n(function() {\r\n  \r\n  exports.stripBOM = function(str) {\r\n    if (str[0] === '\\uFEFF') {\r\n      return str.substring(1);\r\n    } else {\r\n      return str;\r\n    }\r\n  };\r\n\r\n}).call(this);\r\n","// Generated by CoffeeScript 1.12.7\r\n(function() {\r\n  \r\n  var prefixMatch;\r\n\r\n  prefixMatch = new RegExp(/(?!xmlns)^.*:/);\r\n\r\n  exports.normalize = function(str) {\r\n    return str.toLowerCase();\r\n  };\r\n\r\n  exports.firstCharLowerCase = function(str) {\r\n    return str.charAt(0).toLowerCase() + str.slice(1);\r\n  };\r\n\r\n  exports.stripPrefix = function(str) {\r\n    return str.replace(prefixMatch, '');\r\n  };\r\n\r\n  exports.parseNumbers = function(str) {\r\n    if (!isNaN(str)) {\r\n      str = str % 1 === 0 ? parseInt(str, 10) : parseFloat(str);\r\n    }\r\n    return str;\r\n  };\r\n\r\n  exports.parseBooleans = function(str) {\r\n    if (/^(?:true|false)$/i.test(str)) {\r\n      str = str.toLowerCase() === 'true';\r\n    }\r\n    return str;\r\n  };\r\n\r\n}).call(this);\r\n"]}