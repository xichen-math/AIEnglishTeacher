<view class="chat-container">
  <!-- 自定义导航栏 -->
  <view class="custom-nav">
    <view class="back-btn" bindtap="handleBack">
      <view class="back-icon"></view>
    </view>
    <view class="nav-title">AI英语教师</view>
  </view>

  <!-- PPT 显示区域 -->
  <view class="ppt-container">
    <image class="ppt-slide" src="{{currentSlide}}" mode="aspectFit"></image>
    <canvas type="2d" id="pptCanvas" class="ppt-canvas" bindtap="handleCanvasClick"></canvas>
    <view class="ppt-controls">
      <view class="arrow-btn prev" bindtap="prevSlide" hidden="{{currentIndex === 0}}">◀</view>
      <view class="arrow-btn next" bindtap="nextSlide" hidden="{{currentIndex === slides.length - 1}}">▶</view>
    </view>
    <view wx:if="{{showTrophy}}" class="trophy {{moveTrophy ? 'move' : ''}}" 
          style="left: {{trophyPosition.x}}px; top: {{trophyPosition.y}}px">🏆</view>
    <view class="float-back-btn" bindtap="handleBack">
      <view class="back-icon"></view>
    </view>
    <view class="fullscreen-btn" bindtap="toggleFullscreen">⤢</view>
  </view>

  <!-- 聊天区域 -->
  <view class="chat-area" hidden="{{!showChat}}">
    <scroll-view class="chat-list" scroll-y="true" scroll-into-view="{{scrollToMessage}}" scroll-with-animation="true">
      <view class="message-list">
        <block wx:for="{{messages}}" wx:key="id">
          <view class="message {{item.type === 'ai' ? 'message-ai' : 'message-user'}}" id="msg-{{item.id}}">
            <view class="message-content">{{item.content}}</view>
          </view>
        </block>
      </view>
    </scroll-view>

    <!-- 底部操作区 -->
    <view class="footer">
      <view class="input-area">
        <input class="text-input" 
               type="text" 
               placeholder="输入文字..." 
               value="{{inputText}}"
               bindinput="onInputChange"
               confirm-type="send"
               bindconfirm="sendTextMessage"/>
        <button class="send-button" bindtap="sendTextMessage" disabled="{{!inputText}}">发送</button>
      </view>
      <view class="controls">
        <button class="chat-button {{isRecording ? 'recording' : ''}}"
                bindtouchstart="startRecording"
                bindtouchend="stopRecording">
          {{isRecording ? '松开发送' : '按住说话'}}
        </button>
        <button class="end-button" bindtap="endChat">结束对话</button>
      </view>
    </view>
  </view>
</view> 